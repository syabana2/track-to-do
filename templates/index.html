<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Second Brain</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Markdown & Syntax Highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <div class="container">
        <nav class="navigation">
            <h1>Second Brain</h1>
            <div class="nav-buttons">
                <button onclick="showView('dashboard')" class="nav-btn">Dashboard</button>
                <button onclick="showView('todo')" class="nav-btn active">Todo List</button>
                <button onclick="showView('kanban')" class="nav-btn">Kanban</button>
                <button onclick="showView('credentials')" class="nav-btn">Server Credentials</button>
                <button onclick="showView('notes')" class="nav-btn">Notes</button>
            </div>
        </nav>

        <!-- Global Filters -->
        <div class="filters-container">
            <div class="filter-group">
                <label>üîç Search by Title</label>
                <input type="text" id="filter-search" placeholder="Search tasks..." onkeyup="applyFilters()">
            </div>
            <div class="filter-group">
                <label>üìÅ Filter by Project</label>
                <select id="filter-project" onchange="applyFilters()">
                    <option value="">All Projects</option>
                </select>
            </div>
            <div class="filter-group">
                <label>üéØ Filter by Priority</label>
                <select id="filter-priority" onchange="applyFilters()">
                    <option value="">All Priorities</option>
                    <option value="high">üî¥ High</option>
                    <option value="medium">üü° Medium</option>
                    <option value="low">üü¢ Low</option>
                </select>
            </div>
            <div class="filter-group">
                <label>üìä Filter by Status</label>
                <select id="filter-status" onchange="applyFilters()">
                    <option value="">All Status</option>
                    <option value="todo">Todo</option>
                    <option value="in-progress">In Progress</option>
                    <option value="done">Done</option>
                </select>
            </div>
            <div class="filter-group">
                <label>üìÖ Date From</label>
                <input type="date" id="filter-date-from" onchange="applyFilters()">
            </div>
            <div class="filter-group">
                <label>üìÖ Date To</label>
                <input type="date" id="filter-date-to" onchange="applyFilters()">
            </div>
            <div class="filter-group filter-actions">
                <button onclick="clearFilters()" class="btn-clear-filter">Clear All Filters</button>
            </div>
        </div>

        <!-- Dashboard View -->
        <div id="dashboard-view" class="view" style="display: none;">
            <h2>üìä Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-todo">0</div>
                    <div class="stat-label">Todo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-in-progress">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-done">0</div>
                    <div class="stat-label">Done</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-completed-today">0</div>
                    <div class="stat-label">Completed Today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-time">0h 0m</div>
                    <div class="stat-label">Total Time</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-avg-time">0h 0m</div>
                    <div class="stat-label">Avg Time/Task</div>
                </div>
            </div>

            <div class="charts-container">
                <div class="chart-card">
                    <h3>üìà Tasks Created - Last 7 Days</h3>
                    <canvas id="tasks-created-chart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>‚úÖ Tasks Completed - Last 7 Days</h3>
                    <canvas id="tasks-completed-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Todo List View -->
        <div id="todo-view" class="view">
            <div class="section-header">
                <h2>‚úÖ Todo List</h2>
                <button onclick="openAddTaskModal()" class="btn-primary">+ Add Task</button>
            </div>
            <div id="todo-list" class="task-list"></div>
        </div>

        <!-- Kanban View -->
        <div id="kanban-view" class="view" style="display: none;">
            <h2>üìå Kanban Board</h2>
            <div class="kanban-board">
                <div class="kanban-column">
                    <h3>üìù Todo</h3>
                    <div id="kanban-todo" class="kanban-tasks" data-status="todo"></div>
                </div>
                <div class="kanban-column">
                    <h3>‚öôÔ∏è In Progress</h3>
                    <div id="kanban-in-progress" class="kanban-tasks" data-status="in-progress"></div>
                </div>
                <div class="kanban-column">
                    <h3>‚úîÔ∏è Done</h3>
                    <div id="kanban-done" class="kanban-tasks" data-status="done"></div>
                </div>
            </div>
        </div>

        <!-- Server Credentials View -->
        <div id="credentials-view" class="view" style="display: none;">
            <div class="section-header">
                <h2>üîê Server Credentials</h2>
                <button onclick="openAddCredentialModal()" class="btn-primary">+ Add Credential</button>
            </div>

            <!-- Credentials Filters -->
            <div class="credentials-filters">
                <input type="text" id="credentials-search" placeholder="Search by title or IP..." onkeyup="applyCredentialFilters()">
                <select id="credentials-project-filter" onchange="applyCredentialFilters()">
                    <option value="">All Projects</option>
                </select>
                <div class="filter-tags-container">
                    <label>Filter by Tags:</label>
                    <div id="credentials-filter-selected-tags" class="filter-selected-tags"></div>
                    <input type="text" id="credentials-filter-tag-input" placeholder="Type to search tags..." autocomplete="off">
                    <div id="credentials-filter-tag-suggestions" class="tag-suggestions"></div>
                </div>
                <button onclick="clearCredentialFilters()" class="btn-clear-filter">Clear Filters</button>
            </div>

            <div id="credentials-list" class="credentials-grid"></div>
        </div>

        <!-- Notes View -->
        <div id="notes-view" class="view" style="display: none;">
            <div class="section-header">
                <h2>üìù Notes & Documentation</h2>
                <button onclick="openAddNoteModal()" class="btn-primary">+ Add Note</button>
            </div>

            <!-- Notes Filter -->
            <div class="notes-filters">
                <input type="text" id="notes-search" placeholder="Search notes..." onkeyup="filterNotes()">
                <div class="filter-tags-container">
                    <label>Filter by Tags:</label>
                    <div id="notes-filter-selected-tags" class="filter-selected-tags"></div>
                    <input type="text" id="notes-filter-tag-input" placeholder="Type to search tags..." autocomplete="off">
                    <div id="notes-filter-tag-suggestions" class="tag-suggestions"></div>
                </div>
                <select id="notes-task-filter" onchange="filterNotes()">
                    <option value="">All Tasks</option>
                </select>
            </div>

            <div id="notes-list" class="notes-grid"></div>
        </div>

        <!-- Add/Edit Task Modal -->
        <div id="task-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Add New Task</h3>
                    <span class="close" onclick="closeModal()">&times;</span>
                </div>
                <form id="task-form" onsubmit="saveTask(event)">
                    <input type="hidden" id="task-id">

                    <div class="form-section">
                        <div class="form-group-full">
                            <label>Task Title *</label>
                            <input type="text" id="task-title" required placeholder="Enter task title">
                        </div>

                        <div class="form-group-full">
                            <label>Description</label>
                            <textarea id="task-description" rows="3" placeholder="Add task description (optional)"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="form-row-2">
                            <div class="form-group">
                                <label>üìÖ Created Date</label>
                                <input type="date" id="task-created-date">
                            </div>
                            <div class="form-group">
                                <label>üìÖ Due Date</label>
                                <input type="date" id="task-due-date">
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="form-group">
                                <label>üìÅ Project</label>
                                <input type="text" id="task-project" list="project-list" placeholder="Select or type project name">
                                <datalist id="project-list"></datalist>
                            </div>
                            <div class="form-group">
                                <label>üéØ Priority</label>
                                <select id="task-priority">
                                    <option value="low">üü¢ Low</option>
                                    <option value="medium" selected>üü° Medium</option>
                                    <option value="high">üî¥ High</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="form-group">
                                <label>üìä Status</label>
                                <select id="task-status">
                                    <option value="todo">üìù Todo</option>
                                    <option value="in-progress">‚öôÔ∏è In Progress</option>
                                    <option value="done">‚úÖ Done</option>
                                </select>
                            </div>
                            <div class="form-group"></div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" onclick="closeModal()" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Save Task</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

        <!-- Add/Edit Credential Modal -->
        <div id="credential-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="credential-modal-title">Add Server Credential</h3>
                    <span class="close" onclick="closeCredentialModal()">&times;</span>
                </div>
                <form id="credential-form" onsubmit="saveCredential(event)">
                    <input type="hidden" id="credential-id">

                    <div class="form-section">
                        <div class="form-group-full">
                            <label>Title *</label>
                            <input type="text" id="credential-title" required placeholder="e.g., Production Server">
                        </div>

                        <div class="form-group-full">
                            <label>üìÅ Project</label>
                            <input type="text" id="credential-project" list="credential-project-list" placeholder="Select or type project name">
                            <datalist id="credential-project-list"></datalist>
                        </div>

                        <div class="form-group-full">
                            <label>üè∑Ô∏è Tags</label>
                            <div class="tags-input-container">
                                <div id="credential-selected-tags" class="selected-tags"></div>
                                <input type="text" id="credential-tag-input" placeholder="Type and press Enter or Space to add tags..." onkeydown="handleCredentialTagInput(event)" oninput="showCredentialTagSuggestions(event)" autocomplete="off">
                                <div id="credential-tag-suggestions" class="tag-suggestions"></div>
                            </div>
                            <input type="hidden" id="credential-tags">
                        </div>

                        <div class="form-group-full">
                            <label>IP Address *</label>
                            <input type="text" id="credential-ip" required placeholder="e.g., 192.168.1.100">
                        </div>

                        <div class="form-group-full">
                            <label>Password *</label>
                            <input type="password" id="credential-password" required placeholder="Enter password">
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" onclick="closeCredentialModal()" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Save Credential</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add/Edit Note Modal -->
        <div id="note-modal" class="modal">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h3 id="note-modal-title">Add New Note</h3>
                    <span class="close" onclick="closeNoteModal()">&times;</span>
                </div>
                <form id="note-form" onsubmit="saveNote(event)">
                    <input type="hidden" id="note-id">

                    <div class="form-section">
                        <div class="form-group-full">
                            <label>Title *</label>
                            <input type="text" id="note-title" required placeholder="Enter note title">
                        </div>

                        <div class="form-group-full">
                            <label>Content (Markdown supported)</label>
                            <div class="editor-toolbar">
                                <button type="button" onclick="insertMarkdown('**', '**')" title="Bold">B</button>
                                <button type="button" onclick="insertMarkdown('*', '*')" title="Italic">I</button>
                                <button type="button" onclick="insertMarkdown('`', '`')" title="Code">&lt;/&gt;</button>
                                <button type="button" onclick="insertMarkdown('```\n', '\n```')" title="Code Block">{ }</button>
                                <button type="button" onclick="insertMarkdown('# ', '')" title="Heading">#</button>
                                <button type="button" onclick="insertMarkdown('- ', '')" title="List">‚Ä¢</button>
                                <button type="button" onclick="insertMarkdown('[', '](url)')" title="Link">üîó</button>
                                <button type="button" onclick="togglePreview()" id="preview-toggle">Preview</button>
                            </div>
                            <textarea id="note-content" rows="10" placeholder="Write your note in Markdown..."></textarea>
                            <div id="note-preview" class="markdown-preview" style="display: none;"></div>
                        </div>

                        <div class="form-row-2">
                            <div class="form-group">
                                <label>üè∑Ô∏è Tags</label>
                                <div class="tags-input-container">
                                    <div id="note-selected-tags" class="selected-tags"></div>
                                    <input type="text" id="note-tag-input" placeholder="Type and press Enter or Space to add tags..." onkeydown="handleNoteTagInput(event)" oninput="showNoteTagSuggestions(event)" autocomplete="off">
                                    <div id="note-tag-suggestions" class="tag-suggestions"></div>
                                </div>
                                <input type="hidden" id="note-tags">
                            </div>
                            <div class="form-group">
                                <label>Link to Task (optional)</label>
                                <div class="searchable-dropdown" id="task-dropdown-container">
                                    <input type="text" id="note-task-search" placeholder="Search tasks..." autocomplete="off">
                                    <div class="searchable-dropdown-list" id="task-dropdown-list"></div>
                                </div>
                                <input type="hidden" id="note-task">
                            </div>
                        </div>

                        <div class="form-group-full">
                            <label>Link to Notes (internal linking)</label>
                            <div id="note-links-container" class="notes-links"></div>
                            <div class="searchable-dropdown" id="note-link-dropdown-container">
                                <input type="text" id="note-link-search" placeholder="Search notes to link..." autocomplete="off">
                                <div class="searchable-dropdown-list" id="note-link-dropdown-list"></div>
                            </div>
                        </div>

                        <div class="form-group-full">
                            <label>Attachments</label>
                            <input type="file" id="note-attachment" multiple>
                            <div id="note-attachments-list" class="attachments-list"></div>
                        </div>

                        <div class="form-group-full" id="version-history-section" style="display: none;">
                            <label>Version History</label>
                            <div id="version-history-list" class="version-list"></div>
                        </div>
                    </div>

                    <div class="modal-actions">
                        <button type="button" onclick="closeNoteModal()" class="btn-secondary">Cancel</button>
                        <button type="submit" class="btn-primary">Save Note</button>
                    </div>
                </form>
            </div>
        </div>

    <script src="/static/script.js"></script>
</body>
</html>
